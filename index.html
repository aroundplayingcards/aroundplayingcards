<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Around Playing Cards | Cardistry</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --bg-color: #000;
      --text-color: #fff;
      --accent-color: #c0c0c0;
      --radius: 12px;
      --transition: 0.4s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Space Grotesk', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      overflow-x: hidden;
      position: relative;
    }

    canvas#fluid-bg {
      position: fixed;
      top: 0;
      left: 0;
      z-index: -1;
      width: 100vw;
      height: 100vh;
      opacity: 0.7;
      pointer-events: none;
      filter: blur(1.5px) brightness(1.2) saturate(1.5);
      transition: opacity 0.3s;
    }
    /* Galleria carte migliorata */
    .products {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 36px;
      padding: 60px 40px;
      background: rgba(17,17,17,0.85);
      box-shadow: 0 8px 48px #0005;
      border-radius: 22px !important;
    }
    .product {
      background: rgba(35,35,35,0.82);
      padding: 24px 18px 18px 18px;
      border-radius: 22px !important;
      text-align: center;
      transition: box-shadow 0.3s, transform 0.3s;
      box-shadow: 0 0 32px rgba(0,0,0,0.18);
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    .product:hover {
      transform: translateY(-8px) scale(1.03);
      box-shadow: 0 8px 48px #c0c0c055;
      border: 2px solid #c0c0c0;
      background: rgba(60,60,60,0.92);
    }
    .product img {
      max-width: 100%;
      border-radius: 12px;
      box-shadow: 0 2px 16px #0005;
      transition: transform 0.3s;
    }
    .product:hover img {
      transform: scale(1.07) rotate(-2deg);
    }
    .product h3 {
      margin-top: 18px;
      font-size: 1.3rem;
      color: #fff;
    }
    .product p {
      font-size: 1rem;
      margin: 10px 0 0 0;
      opacity: 0.8;
      color: #c0c0c0;
    }
    .product .price {
      color: #ffe082;
      font-weight: bold;
      font-size: 1.1rem;
      margin: 10px 0 0 0;
    }
    .product .add-to-cart {
      margin-top: 14px;
    }
    /* Modal dettaglio mazzo */
    .modal-bg {
      display: none;
      position: fixed;
      z-index: 3000;
      left: 0; top: 0; width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.7);
      align-items: center;
      justify-content: center;
      transition: opacity 0.3s;
    }
    .modal-bg.active {
      display: flex;
    }
    .deck-modal {
      max-width: 900px;
      min-height: 420px;
      display: flex;
      gap: 32px;
      align-items: flex-start;
      padding: 40px 32px 32px 32px;
      background: rgba(24,24,24,0.97) !important;
      color: #fff;
      border-radius: 22px !important;
      box-shadow: 0 12px 64px #000b;
      position: relative;
      animation: modalIn 0.3s cubic-bezier(.4,0,.2,1);
    }
    @keyframes modalIn {
      from { transform: scale(0.8) translateY(40px); opacity: 0; }
      to { transform: scale(1) translateY(0); opacity: 1; }
    }
    .deck-modal .close-modal {
      position: absolute;
      top: 16px; right: 18px;
      background: none;
      border: none;
      color: #fff;
      font-size: 2rem;
      cursor: pointer;
      transition: color 0.2s;
    }
    .deck-modal .close-modal:hover {
      color: #ffe082;
    }
    .deck-modal .modal-left {
      flex: 1.2;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    .deck-modal .modal-main-img {
      width: 320px;
      height: 420px;
      object-fit: cover;
      border-radius: 14px;
      box-shadow: 0 4px 32px #0008;
      margin-bottom: 18px;
      background: #222;
    }
    .deck-modal .modal-images {
      gap: 8px;
      margin-bottom: 0;
    }
    .deck-modal .modal-images img {
      width: 60px;
      height: 80px;
      border-radius: 6px;
      cursor: pointer;
      opacity: 0.8;
      border: 2px solid transparent;
      transition: border 0.2s, opacity 0.2s;
    }
    .deck-modal .modal-images img.selected,
    .deck-modal .modal-images img:hover {
      border: 2px solid #ffe082;
      opacity: 1;
    }
    .deck-modal .modal-right {
      flex: 1.5;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      gap: 8px;
    }
    .deck-modal h2 {
      font-size: 2rem;
      margin-bottom: 8px;
      color: #ffe082;
    }
    .deck-modal .modal-desc {
      font-size: 1.13rem;
      margin-bottom: 10px;
      color: #c0c0c0;
    }
    .deck-modal .modal-features {
      font-size: 1.05rem;
      margin-bottom: 16px;
      color: #fff;
      list-style: disc inside;
      text-align: left;
    }
    .deck-modal .modal-price {
      font-size: 1.3rem;
      color: #ffe082;
      font-weight: bold;
      margin-bottom: 18px;
    }
    .deck-modal .add-to-cart {
      width: 100%;
      margin-top: 0;
      font-size: 1.15rem;
      background: linear-gradient(90deg,#ffe082,#c0c0c0);
      color: #222;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      box-shadow: 0 2px 12px #ffe08244;
    }
    .deck-modal .add-to-cart:hover {
      background: linear-gradient(90deg,#fffbe0,#ffe082);
      color: #000;
    }
    @media (max-width: 900px) {
      .deck-modal { flex-direction: column; align-items: stretch; }
      .deck-modal .modal-left, .deck-modal .modal-right { width: 100%; }
      .deck-modal .modal-main-img { width: 100%; height: 260px; }
    }

    body {
      font-family: 'Space Grotesk', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      overflow-x: hidden;
      position: relative;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 40px;
      background: rgba(0, 0, 0, 0.8);
      position: sticky;
      top: 0;
      z-index: 999;
      backdrop-filter: blur(8px);
    }

    header .logo {
      font-size: 1.5rem;
      font-weight: 700;
      text-transform: uppercase;
    }

    nav a {
      color: var(--text-color);
      margin-left: 30px;
      text-decoration: none;
      position: relative;
      transition: color var(--transition);
    }

    nav a::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      height: 2px;
      width: 0;
      background: var(--accent-color);
      transition: var(--transition);
    }

    nav a:hover {
      color: var(--accent-color);
    }

    nav a:hover::after {
      width: 100%;
    }
    .hero {
      height: 60vh;
      min-height: 340px;
      background: linear-gradient(120deg, rgba(10,10,10,0.85), rgba(17,17,17,0.85));
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      text-align: center;
      padding: 0 20px;
      position: relative;
      border-radius: 22px !important;
    }

    .hero h1 {
      font-size: 3.5rem;
      max-width: 800px;
      z-index: 1;
      border-radius: 16px;
    }

    .hero p {
      font-size: 1.2rem;
      margin-top: 20px;
      max-width: 600px;
      opacity: 0.8;
      z-index: 1;
      border-radius: 12px;
    }

    .btn {
      margin-top: 40px;
      padding: 15px 30px;
      border: none;
      background: var(--accent-color);
      color: #000;
      font-weight: 700;
      font-size: 1rem;
      border-radius: var(--radius);
      cursor: pointer;
      transition: var(--transition);
      z-index: 1;
    }

    .btn:hover {
      transform: scale(1.05);
      background: #d0d0d0;
    }

    footer {
      background: #000;
      text-align: center;
      padding: 40px 20px;
      font-size: 0.9rem;
      opacity: 0.6;
      border-radius: 0 0 22px 22px !important;
    }
    /* Nuova barra inferiore minimal */
    .footer-bar {
      background: rgba(17,17,17,0.92);
      color: #fff;
      padding: 36px 0 18px 0;
      border-radius: 0 0 22px 22px !important;
      box-shadow: 0 -4px 32px #0005;
      margin-top: 48px;
      text-align: center;
    }
    .footer-bar .footer-logo {
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: 1px;
      margin-bottom: 18px;
      color: #ffe082;
      display: inline-block;
    }
    .footer-bar .footer-social {
      margin: 0 0 18px 0;
    }
    .footer-bar .footer-social a {
      color: #ffe082;
      font-size: 2.2rem;
      margin: 0 18px;
      transition: color 0.2s;
      display: inline-block;
      vertical-align: middle;
    }
    .footer-bar .footer-social a:hover {
      color: #fff;
    }
    .footer-bar .footer-copy {
      color: #aaa;
      font-size: 1em;
      margin-top: 10px;
      letter-spacing: 0.2px;
    }
    @media (max-width: 700px) {
      .footer-bar {
        padding: 28px 0 12px 0;
      }
      .footer-bar .footer-logo {
        font-size: 1.3rem;
      }
      .footer-bar .footer-social a {
        font-size: 1.5rem;
        margin: 0 10px;
      }
    }

    .cart-sidebar {
      position: fixed;
      top: 0;
      right: -400px;
      width: 400px;
      height: 100vh;
      background: #181818;
      color: #fff;
      box-shadow: -4px 0 24px rgba(0,0,0,0.25);
      z-index: 2000;
      transition: right 0.3s cubic-bezier(.4,0,.2,1);
      display: flex;
      flex-direction: column;
      padding: 0;
      border-radius: 22px 0 0 22px !important;
    }
    .cart-sidebar.active {
      right: 0;
    }
    .cart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 24px 24px 12px 24px;
      border-bottom: 1px solid #333;
    }
    .close-cart-btn {
      background: none;
      border: none;
      color: #fff;
      font-size: 2rem;
      cursor: pointer;
      transition: color 0.2s;
    }
    .close-cart-btn:hover {
      color: #c0c0c0;
    }
    .cart-items {
      flex: 1;
      overflow-y: auto;
      padding: 16px 24px;
    }
    .cart-item {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 18px;
      border-bottom: 1px solid #222;
      padding-bottom: 12px;
    }
    .cart-item img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 8px;
      background: #222;
    }
    .cart-item-info {
      flex: 1;
    }
    .cart-item-title {
      font-weight: 600;
      margin-bottom: 4px;
    }
    .cart-item-price {
      color: #c0c0c0;
      font-size: 0.95rem;
      margin-bottom: 6px;
    }
    .cart-item-qty {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .qty-btn {
      background: #222;
      color: #fff;
      border: none;
      border-radius: 4px;
      width: 28px;
      height: 28px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .qty-btn:hover {
      background: #c0c0c0;
      color: #000;
    }
    .remove-item-btn {
      background: none;
      border: none;
      color: #ff5252;
      font-size: 1.2rem;
      cursor: pointer;
      margin-left: 8px;
    }
    .cart-footer {
      padding: 18px 24px;
      border-top: 1px solid #333;
      background: #181818;
    }
    .cart-total {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 16px;
    }
    .checkout-btn {
      width: 100%;
      padding: 14px;
      background: #c0c0c0;
      color: #000;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .checkout-btn:hover {
      background: #fff;
    }
    .cart-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.45);
      z-index: 1999;
      transition: opacity 0.3s;
    }
    .cart-overlay.active {
      display: block;
    }
    .footer-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 32px;
      background: #111;
      color: #fff;
      padding: 40px 24px 16px 24px;
      border-radius: 22px 22px 0 0 !important;
    }
    .footer-col h3 {
      margin-bottom: 12px;
      font-size: 1.1rem;
      color: #c0c0c0;
    }
    .footer-col ul {
      list-style: none;
      padding: 0;
    }
    .footer-col ul li {
      margin-bottom: 8px;
    }
    .footer-col ul li a {
      color: #fff;
      text-decoration: none;
      transition: color 0.2s;
    }
    .footer-col ul li a:hover {
      color: #c0c0c0;
    }
    .footer-social a {
      color: #fff;
      margin-right: 12px;
      font-size: 1.3rem;
      transition: color 0.2s;
    }
    .footer-social a:hover {
      color: #c0c0c0;
    }
    .footer-lower {
      background: #000;
      color: #aaa;
      text-align: center;
      padding: 12px 0 8px 0;
      font-size: 0.95em;
    }
    @media (max-width: 700px) {
      .footer-content {
        grid-template-columns: 1fr;
        gap: 18px;
      }
    }
  </style>
</head>
<body>
  <svg style="position:absolute;width:0;height:0;">
    <defs>
      <filter id="goo">
        <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="name"/>
        <feColorMatrix in="name" mode="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 15 -10" result="b"/>
        <feBlend in="SourceGraphic" in2="b" />
      </filter>
    </defs>
  </svg>
  <canvas id="fluid-bg"></canvas>
  <header>
    <div class="logo">AroundCards</div>
    <nav>
      <a href="index2.html">Home</a>
      <a href="../pages/about.html">Cardistry</a>
      <a href="../pages/storia.html">Storia</a>
      <a href="../pages/contact.html">Contatti</a>
      <a href="#" id="cart-icon"><i class="fas fa-shopping-cart"></i> <span id="cart-count">0</span></a>
    </nav>
  </header>

  <section class="hero" id="home" style="height:60vh;min-height:340px;">
    <h1>Arte in movimento nelle tue mani</h1>
    <p>Scopri i migliori mazzi per cardistry, con design esclusivi e performance fluide.</p>
    <a href="index.html#mazzi" class="btn">Esplora Mazzi</a>
  </section>

  <div style="height:32px;"></div>

  <section class="products" id="mazzi">
    <div class="product" data-deck="vertex">
      <img src="../decks/silverdrop_logo.png" alt="Silverdrop" style="background:#fff;border:2px solid #c0c0c0;">
      <h3>Vertex</h3>
      <p>Geometrie e dinamismo puro</p>
      <div class="price">€24.95</div>
      <a href="../decks/vertex.html" class="btn" style="margin-top:10px;display:inline-block;">Esplora in dettaglio</a>
    </div>
    <div class="product" data-deck="flux">
      <img src="../decks/silverdrop_logo.png" alt="Silverdrop" style="background:#fff;border:2px solid #c0c0c0;">
      <h3>Flux</h3>
      <p>Flusso e movimento continuo</p>
      <div class="price">€22.95</div>
      <a href="../decks/flux.html" class="btn" style="margin-top:10px;display:inline-block;">Esplora in dettaglio</a>
    </div>
    <div class="product" data-deck="orbit">
      <img src="../decks/silverdrop_logo.png" alt="Silverdrop" style="background:#fff;border:2px solid #c0c0c0;">
      <h3>Orbit V8</h3>
      <p>Ispirazione cosmica</p>
      <div class="price">€19.95</div>
      <a href="../decks/orbit.html" class="btn" style="margin-top:10px;display:inline-block;">Esplora in dettaglio</a>
    </div>
    <div class="product" data-deck="silverdrop">
      <img src="../decks/silverdrop_logo.png" alt="Silverdrop" style="background:#fff;border:2px solid #c0c0c0;">
      <h3>Silverdrop</h3>
      <p>Il mazzo che dona acqua</p>
      <div class="price">€29.95</div>
      <a href="../decks/silverdrop.html" class="btn" style="margin-top:10px;display:inline-block;">Esplora in dettaglio</a>
    </div>
  </section>

  <div style="height:32px;"></div>

  <!-- Nuova barra inferiore minimal -->
  <footer class="footer-bar">
    <div class="footer-logo">AroundCards</div>
    <div class="footer-social">
      <a href="https://facebook.com/aroundcards" target="_blank" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
      <a href="https://instagram.com/aroundcards" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
      <a href="https://tiktok.com/@aroundcards" target="_blank" aria-label="TikTok"><i class="fab fa-tiktok"></i></a>
      <a href="https://youtube.com/aroundcards" target="_blank" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
    </div>
    <div class="footer-copy">© 2025 AroundPlayingCards.com | Tutti i diritti riservati</div>
  </footer>

  <div id="cartSidebar" class="cart-sidebar">
    <div class="cart-header">
      <h3>Il tuo carrello</h3>
      <button id="closeCart" class="close-cart-btn" aria-label="Chiudi carrello">&times;</button>
    </div>
    <div class="cart-items"></div>
    <div class="cart-footer">
      <div class="cart-total">Totale: <span id="cartTotal">€0.00</span></div>
      <button id="checkoutBtn" class="checkout-btn">Procedi all'acquisto</button>
    </div>
  </div>
  <div id="cartOverlay" class="cart-overlay"></div>

  <script>
    // Animazione fade-in su body
    document.body.style.opacity = 0;
    document.body.style.transition = 'opacity 0.7s cubic-bezier(.4,0,.2,1)';
    window.addEventListener('DOMContentLoaded',()=>{document.body.style.opacity=1;});
    // Animazione transizione pagina
    document.querySelectorAll('nav a, .btn').forEach(link => {
      if(link.getAttribute('href') && !link.getAttribute('href').startsWith('#') && !link.getAttribute('href').startsWith('javascript')){
        link.addEventListener('click', function(e) {
          if(link.target==='_blank') return;
          e.preventDefault();
          document.body.style.opacity=0;
          setTimeout(()=>{window.location=link.href;},400);
        });
      }
    });

    const canvas = document.getElementById('fluid-bg');
    let width = canvas.width = window.innerWidth;
    let height = canvas.height = window.innerHeight;
    let gl = canvas.getContext('webgl');
    let time = 0;
    // ===============================
    // CONFIGURAZIONE EFFETTO METABALL
    // Modifica qui i parametri principali dell'effetto
    // ===============================
    const METABALLS_CONFIG = {
      numMetaballs: 27,         // Più metaballs per effetto liquido
      minRadius: 10,            // Raggio minimo più grande
      maxRadius: 80,           // Raggio massimo più piccolo per uniformità
      velocity: 2.2,            // Velocità più bassa per movimento fluido
      minPulseSpeed: 0.025,     // Pulsazione lenta
      maxPulseSpeed: 0.055,     // Pulsazione lenta
      mouseInfluenceRadius: 320, // Influenza mouse molto ampia
      mouseInfluenceStrength: 0.18 // Forza influenza mouse molto forte
    };
    // ===============================

    let numMetaballs = METABALLS_CONFIG.numMetaballs;
    let metaballs = [];
    for (let i = 0; i < numMetaballs; i++) {
      let radius = Math.random() * (METABALLS_CONFIG.maxRadius - METABALLS_CONFIG.minRadius) + METABALLS_CONFIG.minRadius;
      metaballs.push({
        x: Math.random() * (width - 2 * radius) + radius,
        y: Math.random() * (height - 2 * radius) + radius,
        vx: (Math.random() - 0.5) * METABALLS_CONFIG.velocity,
        vy: (Math.random() - 0.5) * METABALLS_CONFIG.velocity,
        r: radius * 0.9,
        baseR: radius * 0.9,
        phase: Math.random() * Math.PI * 2,
        pulseSpeed: METABALLS_CONFIG.minPulseSpeed + Math.random() * (METABALLS_CONFIG.maxPulseSpeed - METABALLS_CONFIG.minPulseSpeed)
      });
    }

    let vertexShaderSrc = `
      attribute vec2 position;
      void main() {
        gl_Position = vec4(position, 0.0, 1.0);
      }
    `;

    let fragmentShaderSrc = `
      precision highp float;
      const float WIDTH = ` + (width >> 0) + `.0;
      const float HEIGHT = ` + (height >> 0) + `.0;
      uniform vec3 metaballs[` + numMetaballs + `];
      uniform float time;
      void main(){
        float x = gl_FragCoord.x;
        float y = gl_FragCoord.y;
        float sum = 0.0;
        float glow = 0.0;
        for (int i = 0; i < ` + numMetaballs + `; i++) {
          vec3 metaball = metaballs[i];
          float dx = metaball.x - x;
          float dy = metaball.y - y;
          float radius = metaball.z;
          float distance = sqrt(dx * dx + dy * dy);
          float influence = (radius * radius) / (dx * dx + dy * dy);
          sum += influence;
          if (distance < radius * 2.0) {
            glow += (radius * 0.5) / distance * 0.01;
          }
        }
        float noise = sin(x * 0.01 + time) * cos(y * 0.01 + time) * 0.1;
        sum += noise;
        if (sum >= 1.0) {
          float intensity = min(1.0, (sum - 1.0) * 2.0 + 0.3);
          float variation = sin(x * 0.005 + time * 0.5) * cos(y * 0.005 + time * 0.3) * 0.1;
          intensity += variation;
          gl_FragColor = vec4(vec3(intensity), 1.0);
          return;
        }
        if (glow > 0.05) {
          float glowIntensity = min(0.3, glow - 0.05);
          gl_FragColor = vec4(vec3(glowIntensity), 1.0);
          return;
        }
        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
      }
    `;

    function compileShader(shaderSource, shaderType) {
      let shader = gl.createShader(shaderType);
      gl.shaderSource(shader, shaderSource);
      gl.compileShader(shader);
      if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
        throw "Shader compile failed with: " + gl.getShaderInfoLog(shader);
      }
      return shader;
    }
    function getUniformLocation(program, name) {
      let uniformLocation = gl.getUniformLocation(program, name);
      if (uniformLocation === -1) {
        throw 'Can not find uniform ' + name + '.';
      }
      return uniformLocation;
    }
    function getAttribLocation(program, name) {
      let attributeLocation = gl.getAttribLocation(program, name);
      if (attributeLocation === -1) {
        throw 'Can not find attribute ' + name + '.';
      }
      return attributeLocation;
    }

    let vertexShader = compileShader(vertexShaderSrc, gl.VERTEX_SHADER);
    let fragmentShader = compileShader(fragmentShaderSrc, gl.FRAGMENT_SHADER);
    let program = gl.createProgram();
    gl.attachShader(program, vertexShader);
    gl.attachShader(program, fragmentShader);
    gl.linkProgram(program);
    gl.useProgram(program);

    let vertexData = new Float32Array([
      -1.0,  1.0,
      -1.0, -1.0,
       1.0,  1.0,
       1.0, -1.0,
    ]);
    let vertexDataBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, vertexDataBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, vertexData, gl.STATIC_DRAW);
    let positionHandle = getAttribLocation(program, 'position');
    gl.enableVertexAttribArray(positionHandle);
    gl.vertexAttribPointer(positionHandle, 2, gl.FLOAT, gl.FALSE, 2 * 4, 0);
    let metaballsHandle = getUniformLocation(program, 'metaballs');
    let timeHandle = getUniformLocation(program, 'time');

    function loop() {
      time += 0.016;
      for (let i = 0; i < numMetaballs; i++) {
        let metaball = metaballs[i];
        let centerX = width / 2;
        let centerY = height / 2;
        let toCenterX = (centerX - metaball.x) * 0.0001;
        let toCenterY = (centerY - metaball.y) * 0.0001;
        metaball.vx += toCenterX;
        metaball.vy += toCenterY;
        metaball.vx += Math.sin(time * 0.7 + i) * 0.02;
        metaball.vy += Math.cos(time * 0.5 + i) * 0.02;
        metaball.x += metaball.vx * 0.98;
        metaball.y += metaball.vy * 0.98;
        metaball.r = metaball.baseR + Math.sin(time * metaball.pulseSpeed + metaball.phase) * 15;
        if (metaball.x < metaball.r || metaball.x > width - metaball.r) {
          metaball.vx *= -0.8;
          metaball.x = Math.max(metaball.r, Math.min(width - metaball.r, metaball.x));
        }
        if (metaball.y < metaball.r || metaball.y > height - metaball.r) {
          metaball.vy *= -0.8;
          metaball.y = Math.max(metaball.r, Math.min(height - metaball.r, metaball.y));
        }
      }
      let dataToSendToGPU = new Float32Array(3 * numMetaballs);
      for (let i = 0; i < numMetaballs; i++) {
        let baseIndex = 3 * i;
        let mb = metaballs[i];
        dataToSendToGPU[baseIndex + 0] = mb.x;
        dataToSendToGPU[baseIndex + 1] = mb.y;
        dataToSendToGPU[baseIndex + 2] = mb.r;
      }
      gl.uniform3fv(metaballsHandle, dataToSendToGPU);
      gl.uniform1f(timeHandle, time);
      gl.clearColor(0.0, 0.0, 0.0, 1.0);
      gl.clear(gl.COLOR_BUFFER_BIT);
      gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
      requestAnimationFrame(loop);
    }

    window.addEventListener('resize', function() {
      width = canvas.width = window.innerWidth;
      height = canvas.height = window.innerHeight;
      gl.viewport(0, 0, width, height);
    });

    let mouseInfluence = {x: width/2, y: height/2, active: false};
    canvas.addEventListener('mousemove', function(e) {
      mouseInfluence.x = e.clientX;
      mouseInfluence.y = e.clientY;
      mouseInfluence.active = true;
      for (let i = 0; i < Math.min(5, numMetaballs); i++) {
        let metaball = metaballs[i];
        let dx = mouseInfluence.x - metaball.x;
        let dy = mouseInfluence.y - metaball.y;
        let distance = Math.sqrt(dx * dx + dy * dy);
        if (distance < METABALLS_CONFIG.mouseInfluenceRadius) {
          let force = (METABALLS_CONFIG.mouseInfluenceRadius - distance) / METABALLS_CONFIG.mouseInfluenceRadius;
          metaball.vx += dx * force * METABALLS_CONFIG.mouseInfluenceStrength;
          metaball.vy += dy * force * METABALLS_CONFIG.mouseInfluenceStrength;
        }
      }
    });
    canvas.addEventListener('mouseleave', function() {
      mouseInfluence.active = false;
    });
    loop();
    // Carrello avanzato con sidebar, gestione prodotti, totale, persistenza
    const cartSidebar = document.getElementById('cartSidebar');
    const cartOverlay = document.getElementById('cartOverlay');
    const cartCountEl = document.getElementById('cart-count');
    const closeCartBtn = document.getElementById('closeCart');
    const checkoutBtn = document.getElementById('checkoutBtn');
    const cartItemsContainer = document.querySelector('.cart-items');
    const cartTotalEl = document.getElementById('cartTotal');
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    function openCart() {
      cartSidebar.classList.add('active');
      cartOverlay.classList.add('active');
    }
    function closeCart() {
      cartSidebar.classList.remove('active');
      cartOverlay.classList.remove('active');
    }
    document.getElementById('cart-icon').addEventListener('click', e => {
      e.preventDefault();
      openCart();
    });
    closeCartBtn.addEventListener('click', closeCart);
    cartOverlay.addEventListener('click', closeCart);

    function updateCartCount() {
      let count = cart.reduce((sum, item) => sum + item.qty, 0);
      cartCountEl.textContent = count;
    }
    function updateCartTotal() {
      let total = cart.reduce((sum, item) => sum + item.qty * item.price, 0);
      cartTotalEl.textContent = '€' + total.toFixed(2);
    }
    function saveCart() {
      localStorage.setItem('cart', JSON.stringify(cart));
    }
    function renderCart() {
      cartItemsContainer.innerHTML = '';
      if (cart.length === 0) {
        cartItemsContainer.innerHTML = '<p style="color:#aaa">Il carrello è vuoto.</p>';
        return;
      }
      cart.forEach((item, idx) => {
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
          <img src="${item.img}" alt="${item.name}">
          <div class="cart-item-info">
            <div class="cart-item-title">${item.name}</div>
            <div class="cart-item-price">€${item.price.toFixed(2)}</div>
            <div class="cart-item-qty">
              <button class="qty-btn" data-idx="${idx}" data-action="dec">-</button>
              <span>${item.qty}</span>
              <button class="qty-btn" data-idx="${idx}" data-action="inc">+</button>
              <button class="remove-item-btn" data-idx="${idx}" title="Rimuovi">&times;</button>
            </div>
          </div>
        `;
        cartItemsContainer.appendChild(div);
      });
      // Gestione quantità e rimozione
      cartItemsContainer.querySelectorAll('.qty-btn').forEach(btn => {
        btn.onclick = function() {
          const idx = +btn.dataset.idx;
          if (btn.dataset.action === 'inc') cart[idx].qty++;
          else if (btn.dataset.action === 'dec' && cart[idx].qty > 1) cart[idx].qty--;
          saveCart();
          renderCart();
          updateCartCount();
          updateCartTotal();
        };
      });
      cartItemsContainer.querySelectorAll('.remove-item-btn').forEach(btn => {
        btn.onclick = function() {
          const idx = +btn.dataset.idx;
          cart.splice(idx, 1);
          saveCart();
          renderCart();
          updateCartCount();
          updateCartTotal();
        };
      });
    }
    function addToCart(product) {
      const found = cart.find(item => item.id === product.id);
      if (found) {
        found.qty++;
      } else {
        cart.push({...product, qty: 1});
      }
      saveCart();
      renderCart();
      updateCartCount();
      updateCartTotal();
      openCart();
    }
    document.querySelectorAll('.add-to-cart').forEach(btn => {
      btn.addEventListener('click', function() {
        const prodDiv = btn.closest('.product');
        const name = prodDiv.querySelector('h3').textContent;
        const price = parseFloat(prodDiv.querySelector('.price').textContent.replace('€','').replace(',','.'));
        const img = prodDiv.querySelector('img').src;
        const id = name.toLowerCase().replace(/\s+/g,'-');
        addToCart({id, name, price, img});
      });
    });
    checkoutBtn.addEventListener('click', function() {
      if (cart.length === 0) return alert('Il carrello è vuoto!');
      alert('Grazie per il tuo acquisto! (Checkout demo)');
      cart = [];
      saveCart();
      renderCart();
      updateCartCount();
      updateCartTotal();
      closeCart();
    });
    // Inizializzazione
    renderCart();
    updateCartCount();
    updateCartTotal();
  </script>
</body>
</html>
